# Fyrlang Memory Benchmarks

This repository contains the code used to benchmark the [Fyr](https://github.com/vs-ude/fyrlang) compiler memory allocator performance.

## Run

Setup the `fyrlang-native-libs`.  
Setup the `.env` file byt copying `.env_example` and filling in the correct values.  

Run
```
make -B FYR_NATIVE_MALLOC=jemalloc bench
make -B FYR_NATIVE_MALLOC=tcmalloc bench
```

Now you can inspect the logfiles in `logs/`.
To run specific compilations or benchmarks, see the list generated by `make list_targets`.

## Options

You can configure the benchmarks behavior using the `.env` and `src/common/measurement.h` files.  
Additionally there are some options available via environment variables.
- `FYR_NATIVE_MALLOC=x` passed to `make` will cause the binaries to use the given `malloc` implementation. Also pass `-B` to ensure that everything is properly rebuilt.
- `SET_TIMESTAMP=y` will cause the benchmarks to be logged in timestamped files.
